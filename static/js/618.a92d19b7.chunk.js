"use strict";(self.webpackChunkTomoTheCat=self.webpackChunkTomoTheCat||[]).push([[618],{98618:(n,e,t)=>{var o,i;t.r(e),t.d(e,{FractalWalletAdapterImpl:()=>O}),function(n){n.PROJECT_APPROVED="PROJECT_APPROVED",n.HANDSHAKE="HANDSHAKE",n.HANDSHAKE_ACK="HANDSHAKE_ACK",n.SIGNED_TRANSACTION="SIGNED_TRANSACTION",n.SIGNED_PARTIAL_TRANSACTION="SIGNED_PARTIAL_TRANSACTION",n.FAILED_TO_SIGN_TRANSACTION="FAILED_TO_SIGN_TRANSACTION",n.TRANSACTION_DENIED="TRANSACTION_DENIED",n.SOLANA_WALLET_ADAPTER_APPROVED="SOLANA_WALLET_ADAPTER_APPROVED",n.SOLANA_WALLET_ADAPTER_DENIED="SOLANA_WALLET_ADAPTER_DENIED",n.POPUP_CLOSED="POPUP_CLOSED",n.TRANSACTION_SIGNATURE_NEEDED="TRANSACTION_SIGNATURE_NEEDED",n.TRANSACTION_SIGNATURE_NEEDED_RESPONSE="TRANSACTION_SIGNATURE_NEEDED_RESPONSE",n.AUTH_LOADED="AUTH_LOADED",n.MESSAGE_SIGNATURE_NEEDED="MESSAGE_SIGNATURE_NEEDED",n.MESSAGE_SIGNATURE_NEEDED_RESPONSE="MESSAGE_SIGNATURE_NEEDED_RESPONSE",n.ONRAMP_FULFILLMENT_COMPLETE="ONRAMP_FULFILLMENT_COMPLETE",n.ONRAMP_REJECTED="ONRAMP_REJECTED"}(o||(o={})),function(n){n.UNKNOWN="UNKNOWN",n.REACT_SDK="REACT_SDK",n.SOLANA_WALLET_ADAPTER="SOLANA_WALLET_ADAPTER"}(i||(i={}));class s{constructor(n,e){this.validatedOrigin=n,this.targetWindow=e,this.handlers=new Map}off(n,e){const t=this.handlers.get(n);null===t||void 0===t||t.delete(e)}on(n,e){var t;const o=null!==(t=this.handlers.get(n))&&void 0!==t?t:new Set;o.add(e),this.handlers.set(n,o)}send(n){let{event:e,payload:t}=n;this.targetWindow.postMessage({event:e,payload:t},this.validatedOrigin)}runHandlersForEvent(n,e){const t=this.handlers.get(n);if(t)for(const o of t)o(e)}resetHandlers(){this.handlers.clear()}export(){return{off:this.off.bind(this),on:this.on.bind(this),send:this.send.bind(this),validatedOrigin:this.validatedOrigin}}}const a=400,r=600;const c=["resizable","scrollbars=1","status=1"];function l(n){let{left:e=0,scope:t=window,top:o=0,width:i=r,height:s=r,url:a}=n;return t.open(a,"fractal:approval:popup",function(n){let{height:e,left:t,top:o,width:i}=n;return["popup","left=".concat(t),"top=".concat(o),"width=".concat(i),"height=".concat(e),...c].join(",")}({height:s,left:e,top:o,width:i}))}class d{constructor(n){this.platform=n,this.connection=null,this.popupWindow=null,this.handleMessage=n=>{var e,t,i;if("https://www.fractal.is"!==(i=n.origin)&&"https://fractal.is"!==i)return;const a=n.origin;if(this.popupWindow){if(n.data.event===o.HANDSHAKE&&!this.connection){if(!this.verifyAndResetNonce(null===(e=n.data.payload)||void 0===e?void 0:e.nonce))return;this.popupWindow.postMessage({event:o.HANDSHAKE_ACK,payload:{platform:this.platform}},a),this.connection=new s(a,this.popupWindow),null===(t=this.connectionUpdatedCallback)||void 0===t||t.call(this,this.connection)}this.connection&&(this.connection.runHandlersForEvent(n.data.event,n.data.payload),n.data.event===o.POPUP_CLOSED&&this.connection&&(this.resetConnection(),this.popupWindow=null))}}}initialize(){return window.addEventListener("message",this.handleMessage),this}tearDown(){return window.removeEventListener("message",this.handleMessage),this.resetConnection(),this}async open(n){let{url:e,widthPx:t=a,heightPx:o=r,nonce:i}=n;var s;if((null===(s=this.popupWindow)||void 0===s?void 0:s.closed)&&this.resetConnectionAndPopupWindow(),this.popupWindow)return;this.initialize(),i&&(this.nonce=i);const c=window.screenX+(window.innerWidth-t)/2,d=window.screenY+(window.innerHeight-o)/2;this.popupWindow=l({height:o,left:c,top:d,url:"string"===typeof e?e:void 0,width:t}),e instanceof Promise&&this.setUrl(await e)}close(){this.popupWindow&&(this.popupWindow.close(),this.resetConnectionAndPopupWindow())}onConnectionUpdated(n){return this.connectionUpdatedCallback=n,this}getConnection(){return this.connection}setUrl(n){this.popupWindow&&(this.popupWindow.location=n)}resetConnectionAndPopupWindow(){this.resetConnection(),this.popupWindow=null}resetConnection(){var n,e;null===(n=this.connection)||void 0===n||n.resetHandlers(),this.connection=null,null===(e=this.connectionUpdatedCallback)||void 0===e||e.call(this,this.connection)}verifyAndResetNonce(n){if(!this.nonce)return!0;const e=n===this.nonce;return e&&(this.nonce=void 0),e}}t(65043);function p(n){return null!==n&&"object"===typeof n}var h=t(79296),E=t(80350),A=t(40462);function u(){return"".concat(N()).concat(N()).concat(N())}function N(){return(Math.random()+1).toString(36).substring(7)}const g="Unknown Error",T="https://fractal.is",w="".concat(T,"/wallet-adapter/approve"),S="".concat(T,"/wallet-adapter/sign"),_="".concat(T,"/wallet-adapter/sign/message"),D=r,P="RdxqNYxF";class O{constructor(){this.popupManager=new d(i.SOLANA_WALLET_ADAPTER),this.publicKey=null,this.connecting=!1}getPublicKey(){return this.publicKey}async connect(){let n,e;const t=window.localStorage.getItem(P);if(t)return this.publicKey=new E.PublicKey(t),Promise.resolve();const i=u();this.popupManager.open({nonce:i,url:"".concat(w,"/").concat(i)});const s=t=>{if(!function(n){return!!p(n)&&"solanaPublicKey"in n&&"string"===typeof n.solanaPublicKey}(t))return e(new h.Y6("Malformed payload when setting up connection. Expected { solanaPublicKey: string } but "+"received ".concat(JSON.stringify(t)))),void this.popupManager.close();try{this.publicKey=new E.PublicKey(t.solanaPublicKey),window.localStorage.setItem(P,t.solanaPublicKey),n()}catch(o){const n=new h.Kd(o instanceof Error?o.message:g,o);e(n)}this.popupManager.close()},a=()=>{e(new h.Y6("The user denied the connection.")),this.popupManager.close()},r=()=>{e(new h.Y6("The user denied the connection.")),this.popupManager.close()};return this.popupManager.onConnectionUpdated((n=>{n&&(n.on(o.SOLANA_WALLET_ADAPTER_APPROVED,s),n.on(o.SOLANA_WALLET_ADAPTER_DENIED,a),n.on(o.POPUP_CLOSED,r))})),new Promise(((t,o)=>{n=t,e=o}))}async disconnect(){this.popupManager.tearDown(),this.publicKey=null,window.localStorage.removeItem(P)}async signTransaction(n){try{this.checkWalletReadiness();return(await this.signTransactions([n]))[0]}catch(e){let n=e;throw e instanceof h.m7||(n=new h.z4(e instanceof Error?e.message:g,e)),n}}async signAllTransactions(n){try{this.checkWalletReadiness();return await this.signTransactions(n)}catch(e){let n=e;throw e instanceof h.m7||(n=new h.z4(e instanceof Error?e.message:g,e)),n}}async signMessage(n){const e=(new TextDecoder).decode(n);let t,i;const s=n=>{if(!function(n){return!!p(n)&&"decodedSignature"in n&&"string"===typeof n.decodedSignature}(n)){const e=new h.K3("Malformed payload when signing message. Expected { decodedSignature: string } "+"but received ".concat(JSON.stringify(n)));return i(e),void this.popupManager.close()}const e=Uint8Array.from(n.decodedSignature.split(",").map((n=>Number(n))));t(e),this.popupManager.close()},a=()=>{i(new h.K3("The user did not approve the message")),this.popupManager.close()},r=()=>{var n;const t={decodedMessage:e};null===(n=this.popupManager.getConnection())||void 0===n||n.send({event:o.MESSAGE_SIGNATURE_NEEDED,payload:t})},c=u();return this.popupManager.open({heightPx:Math.max(D,Math.floor(.8*window.innerHeight)),nonce:c,url:"".concat(_,"/").concat(c),widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated((n=>{n&&(n.on(o.MESSAGE_SIGNATURE_NEEDED_RESPONSE,s),n.on(o.TRANSACTION_DENIED,a),n.on(o.POPUP_CLOSED,a),n.on(o.AUTH_LOADED,r))})),new Promise(((n,e)=>{t=n,i=e}))}async signTransactions(n){let e,t;const i=n=>{if(!function(n){return!!p(n)&&"signedB58Transactions"in n&&!!Array.isArray(n.signedB58Transactions)&&n.signedB58Transactions.every((n=>"string"===typeof n))}(n)){const e=new h.z4("Malformed payload when signing transactions. Expected { signedB58Transactions: string[] } "+"but received ".concat(JSON.stringify(n)));return t(e),void this.popupManager.close()}const o=n.signedB58Transactions.map((n=>E.Transaction.from(A.decode(n))));e(o),this.popupManager.close()},s=()=>{t(new h.z4("The user did not approve the transaction")),this.popupManager.close()},a=()=>{var e;const t={unsignedB58Transactions:n.map((n=>A.encode(n.serializeMessage())))};null===(e=this.popupManager.getConnection())||void 0===e||e.send({event:o.TRANSACTION_SIGNATURE_NEEDED,payload:t})},r=u();return this.popupManager.open({heightPx:Math.max(D,Math.floor(.8*window.innerHeight)),nonce:r,url:"".concat(S,"/").concat(r),widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated((n=>{n&&(n.on(o.TRANSACTION_SIGNATURE_NEEDED_RESPONSE,i),n.on(o.TRANSACTION_DENIED,s),n.on(o.POPUP_CLOSED,s),n.on(o.AUTH_LOADED,a))})),new Promise(((n,o)=>{e=n,t=o}))}checkWalletReadiness(){if(null===this.publicKey)throw new h.kW("`publicKey` is null. Did you forget to call `.connect()`?")}}}}]);
//# sourceMappingURL=618.a92d19b7.chunk.js.map